
Payloadの利用方法について
-------------------------------------------------

### 指針
- アプリケーションレベルではRESTを気にしたくないのでREST的なI/Fにはしない
- その代わり、関数呼び出しに近いI/Fを採用する

### ガイドライン
- ステータス
  - 処理の成功時には常にPayloadStatus::SUCCESSを用いる
  - システム要因の失敗時には例外を投げる。詳細は規定しない
  - ユーザ要因の失敗時には、内容に応じて下記を用いる（順序も重要）
    - 認証が必要なユースケースなのにユーザが認証していない場合はPayloadStatus::NOT_AUTHENTICATEDを用いる
    - ターゲットパラメータに問題がある場合はPayloadStatus::NOT_FOUNDを用いる
    - ユーザに対象のユースケースを行う権限が無い場合はPayloadStatus::NOT_AUTHORIZEDを用いる
    - フォームデータに問題がある場合はPayloadStatus::NOT_VALIDを用いる
    - 他のユーザ要因ではPayloadStatus::FAILUREを用いる
      - クレジット決済の失敗、在庫の喪失など
- 処理を行ったLink層オブジェクト（ユースケース）を返すのにsetExtras()を用いる
  - これは、Responderがフォームを構築するのに役立つ（リンク層オブジェクトが、フォームをオブジェクトに変換したのと逆の変換を行う）
- フォームデータを返すのにsetInput()を使う
  - パラメータは処理にエラーが発生したときに、入力フォームを再表示するのに有用
- 処理が成功した場合、処理結果を返すのにsetOutput()を使う
  - created系操作では、作成されたオブジェクトを返す
  - refer系操作では、検索結果となるオブジェクトを返す
  - update系操作では、更新後のオブジェクトを返す
  - delete系操作では、削除されたオブジェクトを返す
- 処理が失敗した場合で、ステータスがNOT_VALIDまたはFAILUREの場合には、setMessages()で詳細を説明する
  - フォームの入力項目に問題がある場合は、入力項目ごとにエラーの内容を返す `{name} => {error}`
  - 他のユーザ要因ではreasonキーにエラーの内容を返す `reason => {error}`


### ガイドラインvol2

- 結果となるオブジェクト：表示のために
- フォーム：フォームの表示のために。入力されたフォーム、オブジェクトをフォームに変換したもの
- エラーメッセージ：エラーの表示のために
- 対象となるオブジェクト：基本情報の表示のために

- 結果となるオブジェクト：output
- 入力内容：input
- エラーメッセージ：messages
- ターゲット：target